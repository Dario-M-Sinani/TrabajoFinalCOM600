# Borramos la línea 'version: 3.8', ya no es necesaria y genera un warning.

services:
  # --- Servicio de Base de Datos PostgreSQL ---
  db_apuestas:
    image: postgres:15-alpine
    container_name: casigano-db-postgres
    restart: always
    
    # --- BLOQUE AÑADIDO (¡Este faltaba!) ---
    # Estas son las instrucciones para crear la BD
    environment:
      POSTGRES_USER: casigano_user
      POSTGRES_PASSWORD: casigano_pass
      POSTGRES_DB: casigano_apuestas_db
      
    ports:
      - "5432:5432" # Expone el puerto de la BD a tu máquina
    volumes:
      - postgres-data:/var/lib/postgresql/data
      # Esta línea asume que tu SQL está en la carpeta 'db_init' (con guion bajo)
      - ./db_init/init.sql:/docker-entrypoint-initdb.d/init.sql
    networks:
      - casigano-net

  # --- Tu Microservicio de Apuestas en Go ---
  apuestas-go:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: casigano-svc-apuestas
    restart: on-failure
    
    # --- BLOQUE AÑADIDO (¡Este también faltaba!) ---
    # Esta es la instrucción para que tu app Go encuentre la BD
    environment:
      DATABASE_URL: "postgres://casigano_user:casigano_pass@db_apuestas:5432/casigano_apuestas_db?sslmode=disable"
      
    ports:
      - "8081:8081" # Expone el puerto de tu API
    depends_on:
      - db_apuestas # Espera a que la BD esté lista
    networks:
      - casigano-net

# --- Volúmenes y Redes ---
volumes:
  postgres-data: # El volumen nombrado para persistir la BD

networks:
  casigano-net: # Define la red que los servicios pueden usar
    driver: bridge